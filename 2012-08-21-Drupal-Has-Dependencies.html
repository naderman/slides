<!DOCTYPE html>
<html>
    <head>
        <title>Drupal Has Dependencies - Let's Manage Them!</title>
        <meta name="author" content="Nils Adermann, Rob Loach" />
        <meta name="email" content="naderman@naderman.de" />
        <meta name="date" content="2012-08-21" />
        <meta name="venue" content="DrupalCon Munich 2012" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <!-- Slippy core file and dependencies -->
        <script type="text/javascript" src="vendor/seldaek/slippy/src/jquery.min.js"></script>
        <script type="text/javascript" src="vendor/seldaek/slippy/src/jquery.history.js"></script>
        <script type="text/javascript" src="vendor/seldaek/slippy/src/slippy.js"></script>
        <!-- Slippy structural styles -->
        <link type="text/css" rel="stylesheet" href="vendor/seldaek/slippy/src/slippy.css"/>
        <!-- Slippy theme -->
        <link type="text/css" rel="stylesheet" href="vendor/seldaek/slippy/src/slippy-pure.css"/>
        <!-- Syntax highlighting core file  -->
        <script type="text/javascript" src="vendor/seldaek/slippy/src/highlighter/shCore.js"></script>
        <!-- Syntax highlighting brushes, remove those you don't need -->
        <script type="text/javascript" src="vendor/seldaek/slippy/src/highlighter/shBrushJScript.js"></script>
        <script type="text/javascript" src="vendor/seldaek/slippy/src/highlighter/shBrushPhp.js"></script>
        <script type="text/javascript" src="vendor/seldaek/slippy/src/highlighter/shBrushXml.js"></script>
        <script type="text/javascript" src="vendor/seldaek/slippy/src/highlighter/shBrushPlain.js"></script>
        <script type="text/javascript" src="vendor/seldaek/slippy/src/highlighter/shBrushBash.js"></script>
        <!-- Syntax highlighting styles-->
        <link type="text/css" rel="stylesheet" href="vendor/seldaek/slippy/src/highlighter/shCore.css"/>
        <link type="text/css" rel="stylesheet" href="vendor/seldaek/slippy/src/highlighter/shThemeEclipse.css"/>
        <!-- Slippy init code -->
        <script type="text/javascript">
            $(function() {
                SyntaxHighlighter.all();
                $(".slide").slippy({
                    animLen: 0
                });
            });
        </script>
        <link href="http://fonts.googleapis.com/css?family=Cabin:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <style type="text/css">
            body {
                font-family: 'Cabin', 'Tahoma', sans-serif;
                background: #fff;
                background-color:#ffffff;
                background-image: -webkit-radial-gradient(50% 50%, ellipse closest-side, #ffffff, #ccc 100%);
                background-image: -moz-radial-gradient(50% 50%, ellipse closest-side, #ffffff, #ccc 100%);
                background-image: -o-radial-gradient(50% 50%, ellipse closest-side, #ffffff, #ccc 100%);
                background-image: -ms-radial-gradient(50% 50%, ellipse closest-side, #ffffff, #ccc 100%);
                background-image: radial-gradient(50% 50%, ellipse closest-side, #ffffff, #ccc 100%);
            }
            div.syntaxhighlighter {
                background: #aaa !important;
            }
            .alertWrapper {
                top: 5%;
                bottom: auto;
            }
            .footer {
                margin-bottom: 0px;
            }
            body.slide-1 .slideDisplay, body.slide-background .slideDisplay {
                display: none;
            }
            body.slide-1 .footer {
                display: none;
            }
            .slideDisplay {
                color: #eee;
            }
            a, a:link {
                text-decoration: none;
            }
            .slide.left h1 {
                text-align: left;
                font-size: 1.2em;
            }
            h1 {
                line-height: 130%;
            }
            ul li {
                line-height: 130%;
            }
            p {
                margin-bottom: .7em;
            }
            img.round {
                border-radius: 10px;
            }
            .outline {
                color: #000;
                text-shadow: 0 0 3px #fff;
            }
            .reverse {
                color: #fff;
                text-shadow: 0 0 3px #000;
            }
            .output {
                display: block;
                background: #ffd;
                padding: .5em;
                white-space: pre;
            }
            .slide em {
                color: #00b;
            }
        </style>
    </head>
    <body>
        <div class="slide big">
            <div class="vcenter">
                <h1>Drupal has Dependencies<br/>Let's manage them<br />&nbsp;</h1>
            </div>
        </div>
        <div class="slide big">
            <div class="vcenter">
                <h1>Drupal has Dependencies<br/>Let's manage them<br /><em>With Composer</em></h1>
            </div>
        </div>

        <div class="slide big">
            <h2>About Me</h2>
            <p>Passionate Free Software Developer<br /> &nbsp; <a href="http://github.com/naderman">http://github.com/naderman</a></p>
            <p>phpBB Development Lead<br /> &nbsp;<a href="http://www.phpbb.com">http://www.phpbb.com</a></p>
            <p>Just launched<br /> &nbsp;<a href="https://www.forumatic.com">https://www.forumatic.com</a><br /> &nbsp;Professional Managed phpBB Hosting</p>
        </div>

        <!-- =============== INTRO =================  -->
        <div class="slide big">
            <div class="vcenter" style="text-align: center">
                <img src="2012-06-07-Composer/logo-composer-transparent.png" alt="Composer" />
            </div>
        </div>

        <div class="slide big">
            <div class="vcenter" style="text-align: center">
                <h1>Package Management in PHP</h1>
                <a href="http://example.preinheimer.com/phpunit.html"><img class="noscale round" src="2012-06-07-Composer/pear.png" alt="" /></a>
            </div>
        </div>

        <div class="slide big">
            <div>
                <h1>The Composer Ecosystem</h1>
                <h2><em>Composer</em> - CLI Tool</h2>
                <ul>
                    <li>Easy to use</li>
                    <li>Installs deps per-project</li>
                    <li>Flexible and embeddable</li>
                    <li>Encourages best practices (PSRs, SPDX, semver)</li>
                </ul>
            </div>
        </div>

        <div class="slide big">
            <div>
                <h1>The Composer Ecosystem</h1>
                <h2><em>Packagist</em> - Package Repository</h2>
                <ul>
                    <li>Aggregates PHP libraries</li>
                    <li>Open to all OSS projects</li>
                    <li>Feeds on VCS (git, hg, svn) repositories</li>
                </ul>
            </div>
        </div>

        <div class="slide big" data-background="2012-06-07-Composer/packagist.png">
        </div>

        <div class="slide big">
            <div>
                <h1>The Composer Ecosystem</h1>
                <h2><em>Satis</em> - Micro Repository</h2>
                <ul>
                    <li>Minimalistic (Pirum-like)</li>
                    <li>Useful for closed source code</li>
                </ul>
            </div>
        </div>

        <div class="slide big">
            <div>
                <h1>The Composer Ecosystem</h1>
                <h2><em>composer/installers</em></h2>
                <h3>Custom Package Installers for</h3>
                <div style="float:right;">
                    <ul style="font-size:75%;">
                        <li>Magento</li>
                        <li>phpBB</li>
                        <li>PPI</li>
                        <li>SilverStripe</li>
                        <li>Symfony1</li>
                        <li>Wordpress</li>
                        <li>Zend Framework 1</li>
                    </ul>
                </div>
                <div style="">
                    <ul style="font-size:75%;">
                        <li>CakePHP</li>
                        <li>CodeIgniter</li>
                        <li>FuelPHP</li>
                        <li>Joomla!</li>
                        <li>Kohana</li>
                        <li>Laravel</li>
                        <li>Lithium</li>
                    </ul>
                </div>
                <h3 style="text-align:center; padding-top:20px; clear:both;">and <em>Drupal</em></h3>
            </div>
        </div>

        <!-- =============== USAGE =================  -->
        <div class="slide big" data-background="2012-06-07-Composer/usage.jpg">
            <div>
                <h1 style="text-align: right" class="outline">Usage Instructions</h1>
            </div>
        </div>

        <div class="slide">
            <h1><em>Using</em> a Composed Project</h1>
            <pre class="brush: bash; gutter: false">
git clone https://github.com/symfony/standard-edition myproject
            </pre>
            <code class="output">Cloning into myproject...</code>
            <pre class="brush: bash; gutter: false">
cd myproject/
            </pre>
            <pre class="brush: bash; gutter: false">
curl -s http://getcomposer.org/installer | php
            </pre>
            <code class="output"><span style="color:green;">All settings correct for using Composer
Composer successfully installed to: /home/bob/myproject/composer.phar</span>

<span style="color:orange;">Use it: php composer.phar</span></code>
        </div>

        <div class="slide">
            <h1><em>Using</em> a Composed Project</h1>
            <pre class="brush: bash; gutter: false">
php composer.phar install
            </pre>
            <code class="output"><span style="color:green;">Installing from lock file</span>
  - Package <span style="color:green;">twig/extensions</span> (<span style="color:orange;">dev-master</span>)
    Downloading
    Unpacking archive
    Cleaning up

[...]

  - Package <span style="color:green;">twig/twig</span> (<span style="color:orange;">1.8.0</span>)
    Downloading
    Unpacking archive
    Cleaning up

  - Package <span style="color:green;">symfony/symfony</span> (<span style="color:orange;">dev-master</span>)
    Downloading
    Unpacking archive
    Cleaning up

<span style="color:green;">Generating autoload files</span></code>
        </div>

        <div class="slide">
            <h1><em>Using</em> a Composed Project</h1>
            <pre class="brush: plain">
vendor/
    autoload.php
    composer/
    monolog/
        monolog/
    symfony/
        symfony/
        monolog-bundle/
    twig/
        twig/
        extensions/
    [...]
            </pre>
        </div>

        <div class="slide">
            <h1><em>One-line</em> Project Initialization</h1>
            <pre class="brush: bash; gutter: false">
php composer.phar create-project <package> [<dir>] [<version>]

php composer.phar create-project symfony/framework-standard-edition
            </pre>
        </div>

        <div class="slide">
            <h1><em>Downloading</em> Project Dependencies</h1>
            <h2>composer.json</h2>
            <ul>
                <li>Located in project root directory</li>
                <li>Defines dependencies</li>
            </ul>
            <pre class="brush: js">
{
    "require": {
        "silex/silex": ">=1.0.0-dev",
        "symfony/finder": "2.1-dev",
        "twig/twig": "1.*",
        "predis/service-provider": "dev-master"
    },
    "require-dev": {
        "mikey179/vfsStream": "*"
    }
}
            </pre>
            <p>Source install: With <code>install --prefer-source</code> it clones/checks out the code.</p>
        </div>

        <div class="slide">
            <h1><em>Creating</em> a Package Definition</h1>
            <pre class="brush: js">
{
    "name": "predis/predis",
    "type": "library",
    "description": "Flexible and feature-complete Redis client",
    "keywords": ["nosql", "redis", "predis"],
    "homepage": "http://github.com/nrk/predis",
    "license": "MIT",
    "authors": [
        {
            "name": "Daniele Alessandri",
            "email": "suppakilla@gmail.com",
            "homepage": "http://clorophilla.net"
        }
    ],
    "require": {
        "php": ">=5.3.0"
    },
    "autoload": {
        "psr-0": {"Predis": "lib/"}
    }
}
            </pre>
            <p>Note: Package Definition === Application/Root Definition</p>
        </div>

        <div class="slide">
            <h1><em>Avoiding</em> version <em>chaos</em><br />in your team</h1>
            <div class="incremental">
                <h2>composer.lock</h2>
                <ul>
                    <li>Lists packages &amp; versions</li>
                    <li>Replaces composer.json</li>
                    <li>Created by <code>composer install</code> (installs your dependencies)</li>
                    <li>Updated by <code>composer update</code> (updates your dependencies)</li>
                    <li>Must be committed in your VCS and shipped with your releases</li>
                </ul>
            </div>
            <div class="incremental">
                <br />
                <h2>Benefits</h2>
                <ul>
                    <li>Everyone on a team works with <strong>exactly</strong> the same dependency versions</li>
                    <li>When deploying, all machines run <strong>exactly</strong> the same dependency versions</li>
                    <li>Users will never get dependency versions that you did not test with</li>
                </ul>
            </div>
        </div>

        <div class="slide">
            <h1>Autoloading</h1>
            <p>Libraries/projects define their namespaces:</p>
            <pre class="brush: js">
"autoload": {
    "psr-0": {
        "Vendor\\Namespace": "lib/"
    },
    "classmap": ["src/", "VeryOld.php"]
},
"include-path": ["src/", ""]
            </pre>

            <div class="incremental">
                <p>Composer builds an autoloader for you:</p>
                <pre class="brush: js">
vendor/autoload.php
                </pre>
            </div>

            <div class="incremental">
                <p>Use the generated autoloader:</p>
                <pre class="brush: php">
require __DIR__.'/../vendor/autoload.php';

use Silex\Application;
use Silex\Extension\TwigExtension;

use Symfony\Component\Finder\Finder;
use Symfony\Component\HttpFoundation\Response;

$app = new Application();
// ...
                </pre>
            </div>
        </div>

        <div class="slide">
            <h1>Alternative Repositories</h1>
            <pre class="brush: js">
"repositories": [
    {
        "type": "composer",
        "url": "http://private.satis.example.org"
    },
    {
        "type": "vcs",
        "url": "git://example.org/MyRepo.git"
    },
    {
        "packagist": false
    }
]
            </pre>

            <p>See <a href="http://getcomposer.org/doc/05-repositories.md">docs</a> for more</p>
        </div>

        <div class="slide">
            <h1>Depending on packages without composer.json</h1>
            <pre class="brush: js">
"repositories": [
    {
        "type": "package",
        "package": {
            "name": "vendor/package",
            "version": "1.0.0",
            "dist": {
                "url": "http://example.org/package.zip",
                "type": "zip"
            },
            "source": {
                "url": "git://example.org/package.git",
                "type": "git",
                "reference": "tag name, branch name or commit hash"
            }
        }
    }
],
"require": {
    "vendor/package": "1.0.0"
}
            </pre>
            <p>Note: repositories are only available to the root package</p>
        </div>

        <!-- =============== STATE =================  -->
        <div class="slide big">
            <div class="vcenter">
                <h1><em>State</em> of the Project</h1>
            </div>
        </div>

        <div class="slide big" data-background="2012-06-07-Composer/contributors2.png">
        </div>

        <div class="slide big">
            <div>
                <h1><em>Adoption</em></h1>
                <ul>
                    <li>&gt;2700 packages on Packagist</li>
                    <li>2'600'000 package installs from Packagist since April</li>
                    <li>Alpha5 released</li>
                    <li>Supported by frameworks/libs</li>
                    <li>(Integration by PaaS providers)</li>
                    <li>(Integration in apps for plugins)</li>
                </ul>
            </div>
        </div>

        <div class="slide big">
            <div>
                <h1><em>Roadmap</em></h1>
                <ul>
                    <li>Support for web assets</li>
                    <li>Cleanups and small missing features</li>
                    <li>Bugfixes</li>
                    <li>Optimizations</li>
                    <li>Beta in September</li>
                    <li>Want to help? <br /><a href="http://github.com/composer/composer/issues">github.com/composer/composer/issues</a></li>
                </ul>
            </div>
        </div>

        <!-- =============== DRUPAL =================  -->
        <div class="slide big">
            <div class="vcenter">
                <h1><em>Drupal</em> and Composer</h1>
            </div>
        </div>

        <div class="slide big">
            <div>
                <h1><em>Drupal 8</em></h1>
                <ul>
                    <li>Uses Composer to handle
                        <ul>
                            <li>Symfony</li>
                            <li>Doctrine Common</li>
                            <li>Twig</li>
                        </ul>
                    </li>
                    <li><em>core/composer.json</em></li>
                    <li>Dependencies committed directly into Drupal</li>
                </ul>
            </div>
        </div>

        <div class="slide big">
            <div>
                <h2><em>Drush</em> Composer</h2>
                <p>Drush wrapper to run Composer commands <a href="http://drupal.org/project/composer">http://dgo.to/composer</a></p>
                <pre class="brush: bash">
    $ drush dl composer
    $ drush composer install
                </pre>
            </div>
        </div>

        <div class="slide big">
            <h2><em>Drush</em> Composer Hooks</h2>
            <p>Drush Composer processes <em>composer.json</em> when modules are installed</p>
            <pre class="brush: bash">
$ drush dl less
Project less (7.x-2.x-dev) downloaded to sites/all/modules/less.
Installing dependencies
  - Installing leafo/lessphp (v0.3.5)
    Downloading: 100%

Writing lock file
Generating autoload files
            </pre>
        </div>

        <div class="slide big">
            <div>
                <h2><em>Drupal</em> Composer Autoload</h2>
                <p>Module to integrate your module with Composer <a href="http://drupal.org/project/composer_autoload">http://dgo.to/composer_autoload</a></p>
                <ul>
                    <li>Automatically includes module <em>autoload.php</em> files</li>
                    <li>Caches the list of files</li>
                </ul>
            </div>
        </div>

        <!-- =============== CONCLUSION =================  -->
        <div class="slide big" data-background="2012-06-07-Composer/wheel.jpg">
            <div class="">
                <h1 style="text-align: right" class="outline">Wishful Thinking</h1>
            </div>
        </div>

        <div class="slide big">
            <div class="vcenter">
                <h1>Look around.</h1>
                <h1>Write small libs.</h1>
                <h1>Share code.</h1>
                <h1>Reuse things.</h1>
                <h1><em>Reinvigorate PHP</em></h1>
            </div>
        </div>

        <!-- End -->
        <div class="slide big">
            <div class="vcenter">
                <h1>Find Out More</h1>
                <ul>
                    <li><a href="http://getcomposer.org">getcomposer.org</a></li>
                    <li><a href="http://packagist.org">packagist.org</a></li>
                    <li><a href="https://github.com/composer">github.com/composer</a></li>
                    <li><a href="https://groups.google.com/forum/#!forum/composer-dev">composer-dev google group</a></li>
                    <li><a href="irc://irc.freenode.org/composer">#composer</a> &amp; <a href="irc://irc.freenode.org/composer-dev">#composer-dev</a></li>
                </ul>
            </div>
        </div>

        <div class="slide big">
            <div class="vcenter">
                <h1>Conversation!</h1>
                <ul>
                    <li>composer.json in project root?</li>
                    <li>Using Composer to install modules?</li>
                    <li>composer.json vs. module.info?</li>
                    <li>Drupal Core as a dependency?</li>
                </ul>
                <br/>
                <h1><a href="https://twitter.com/naderman">@naderman</a></h1>
                <p>Pull Request for Package Cache: <a href="https://github.com/composer/composer/pull/915">github.com/composer/composer/pull/915</a></p>
            </div>
        </div>

        <div class="slide">
            <h1>Root composer.json proposal</h1>
            <pre class="brush: js">
"require": {
    "drupal/core": "8.0.0",
    "my/module1": "1.0.0",
    "my/module2": "2.1.3",
}
            </pre>
            <h1>Drupal Update Process</h1>
            <pre class="brush: js">
"require": {
    "drupal/core": "8.0.1",
    "my/module1": "1.0.0",
    "my/module2": "2.1.3",
}
            </pre>
            <pre class="brush: bash; gutter: false">
php composer.phar update
            </pre>
        </div>

        <div class="slide">
            <h1>Install Drupal with Composer</h1>
            <pre class="brush: bash; gutter: false">
php composer.phar create-project drupal/project
            </pre>
            <h1>Result</h1>
            <ul>
                <li>Standard directory structure</li>
                <li>default config</li>
                <li>...</li>
            </ul>
            <p>composer.json</p>
            <pre class="brush: js">
"require": {
    "drupal/core": "8.0.0",
}
            </pre>
            <p>Drupal Core and dependencies in <code>vendor/</code>
        </div>

        <div class="slide">
            <h1>Bonus Slide: Aliases &amp; Branches</h1>
            <h3>Situation</h3>
            <ul>
                <li>I use <em>symfony/monolog-bundle 2.0.10</em></li>
                <li>I added a feature to monolog in <em>my-feature-branch</em> on my github fork</li>
                <li><em>symfony/monolog-bundle 2.0.10</em> requires <em>symfony/monolog-bridge 2.0.10</em></li>
                <li><em>symfony/monolog-bridge 2.0.10</em> requires <em>monolog/monolog 1.*</em></li>
            </ul>
            <br />
            <h3>Solution</h3>
            <pre class="brush: js">
"repositories": [
    {
        "type": "vcs",
        "url": "git://github.com/my/monolog.git"
    }
]
"require": {
    "symfony/monolog-bundle": "2.0.10",
    "monolog/monolog": "dev-my-feature-branch as 1.1.0"
}
            </pre>
        </div>

        <div class="slide big">
            <div class="vcenter">
                <h1>Thank you.</h1>
            </div>
        </div>

        <div class="layout" data-name="default">
            <content></content>
        </div>

        <div class="footer">
            <span class="left">Nils Adermann</span>
            <span class="right"></span>
            <span class="left">Twitter <a href="http://twitter.com/seldaek">@naderman</a></span>
            <span class="right">Company <a href="https://www.forumatic.com/">Forumatic</a></span>
            <hr class="defloat" />
        </div>
    </body>
</html>
